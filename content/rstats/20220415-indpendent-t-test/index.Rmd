---
title: "Independent sample t-test"
authors:
- admin
date: 2022-04-14T21:13:14-05:00
output:
  html_document:
    highlight: textmate
categories: ["R"]
subtitle: ""
summary: The independent *t* test is used for testing the difference between means of two independent groups. It is particularly useful when the research question requires the comparison of variables (measured at least at the ordinal level) obtained from two independent samples.
tags: ["t-test", "parametric", "compare means"]
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = "center", comment = "", message = FALSE, warning = FALSE)

```

<br>

<img src="/notes/20220415-indpendent-t-test/20220416-t-tests_files/para_non_parametric_tests.jpg"/>

<br>

# Aim

The independent *t* test is used for testing the difference between means of two independent groups. It is particularly useful when the research question requires the comparison of variables (measured at least at the ordinal level) obtained from two independent samples.

<br>

# Assumptions

+ Independence - the two groups are independent of one another.

+ Normality - the dependent variable is normally distributed.

+ Homogeneity of variance - the distribution of the dependent variable for one of the groups being compared has the same variance as the distribution for the other group being compared.

<br>

# Data

We will use a hypothetical dataset about students' memory abilities as our sample exercise data. The students were asked to read unrelated words and later were asked to recall as many words as possible. The number of words correctly recalled for each student is shown below. You can access the dataset using this [link]("https://raw.githubusercontent.com/chris-allones/Research-methods/master/t-test/data/EX4.sav")

```{r}
# loading the required packages
library(tidyverse)
library(haven) # reading .sav (SPSS) data file
library(ggstatsplot) # creating plots for different stat test
library(patchwork) # for combining plots
library(dlookr) # for normality test
library(qqplotr) # add functions to ggplot to for qqplot

# Loading data
memory_ability <- 
  read_sav("https://raw.githubusercontent.com/chris-allones/Research-methods/master/t-test/data/EX4.sav") %>% 
  mutate(gender = as.character(gender),
         gender = factor(gender, levels = 1:2, labels = c("Male", "Female")),
         gender = fct_rev(gender))

# printing dataset
rmarkdown::paged_table(memory_ability, option = list(rows.print = 5))

```

```{r}
# summary
# use psych package for a quick descriptive statistics
psych::describe(memory_ability)

```


<br>

# Testing assumptions

## Independence

During data collection, ensure that the observation in one group are independent of the observations of the other group.

<br>

## Normality test

For a start, a qqplot or the "quantile-quantile" plot can be used to quickly assess whether or not the data or a variable follows a normal distribution. If normally distributed, the data points will lie on the straight diagonal line. For the qqplot below, most of the points lie on the diagonal line but with some deviations along each of the tails. 

```{r}
# qqplot using the base R function
par(mfrow = c(1, 2))
qqnorm(memory_ability[memory_ability$gender == "Female", ]$words, main = "Normal Q-Q Plot: Female Students")
qqline(memory_ability[memory_ability$gender == "Female", ]$words)

qqnorm(memory_ability[memory_ability$gender == "Male", ]$words, main = "Normal Q-Q Plot: Male Students")
qqline(memory_ability[memory_ability$gender == "Male", ]$words)

```

```{r}
# qqplot using ggplot
ggplot(data = memory_ability, mapping = aes(sample = words, color = gender, fill = gender)) +
  stat_qq_band(alpha=0.5, conf=0.95, qtype=1, bandType = "ts") +
  stat_qq_line(identity=TRUE) +
  stat_qq_point(col="black") +
  facet_wrap(~ gender, ncol = 2) +
  theme(text = element_text(size = 18))

```


Often the visual inspection is hard to see the pattern if the data follows a normal distribution. Therefore, we can use the Shapiro-Wilk test for normality. If the significance level is greater than 0.05, then normality is assumed. The Shapiro-Wilk test is recommended when the sample size is small (~ <50).

We will test the distribution of the number of recalled words for each group (i.e., male and female). Then, we will use the function `group_by()` to perform the normality test for each `gender` separately. The result of the Shapiro-Wilk test shows that the computed significance level is greater than 0.05, implying normality can be assumed.


```{r}
# normality test using the dlookr package
memory_ability %>% 
  group_by(gender) %>% 
  normality(words)

```


<br>

## Homogeneity of variance

The Levene's test can be used to check the assumption on the homogeneity of variance. The Levene's tes for equality of variance tests the hypothesis that the two population variances are equal. 

Why do we need to test for the equality of variance? The answer is that even though there is a large difference in the mean value between groups but with a huge variance (i.e., nonhomogenous variance), the difference may not be significant. On the other hand, a small difference in the mean value may be significant when the variance is small (i.e., homogenous variance).

The results below shows that the Levene statistic is $F=0.087$ and the corresponding level of significance is large (i.e., $p>0.05$). Hence, the assumption of homogeneity of variance has not been violated, and the equal variances assumed implying *t* test statistic can be used for evaluating the null hypothesis of equality of means.

```{r}
car::leveneTest(words ~ gender, data = memory_ability, center = "mean")
```

<br>

# Results and interpretation

The result from the $t$ test indicate that there is a significant difference between the male and female samples in the number of words correctly recalled, $t(df=18)=-3.02, p<0.01$. The mean values indicate that females correctly recalled significantly more words (M=22.10) than males(M=17.70).

The confidence interval information shows that the null hypothesis value (i.e., zero) does not fall within the interval. Therefore the null hypothesis of equality of means can be rejected.

```{r}

ind_ttest <- 
t.test(words ~ gender, data = memory_ability, alternative = "two.sided")

ind_ttest

```

```{r}
ggbetweenstats(
  data = memory_ability,
  x = gender,
  y = words,
  type = "parametric",
  var.equal = TRUE # homogenous variance from Leven's test
) + 
  theme(text = element_text(size = 24)) # increase text size


```


We can also compute for the eta-square ($\eta^2$) which can be interpreted in exactly the same as $R^2$ in correlation and regression. That is, approximately 33.63% of the variability in the number of words correctly recalled was explained by the gender manipulation. Eta-square can be calculated by:

$$\eta^2 = \frac{t^2}{t^2 + df}$$

```{r}
ind_ttest$statistic^2 / (ind_ttest$statistic^2 + ind_ttest$parameter)
```

<br>


# Manual computation

The t statistic for the t test for independent sample is given by:

$$
t = \frac{\bar{X_1} - \bar{X_2}}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_1}}}
$$

where $\bar{X}$ is the mean value for each group, $S^2$ is the sample variance, and $n$ number of observation in each group.

```{r}
# X1 - mean words recalled by male
mean_male <- 
memory_ability %>% filter(gender == "Male") %>% summarise(m_words = mean(words)) %>% pull()

# X2 - mean words recalled by female
mean_female <- 
memory_ability %>% filter(gender == "Female") %>% summarise(m_words = mean(words)) %>% pull()

# s1 - variance of words recalled by male
variance_male <- 
memory_ability %>% filter(gender == "Male") %>% summarise(m_words = var(words)) %>% pull()

# s2 - variance of words recalled by female
variance_female <- 
memory_ability %>% filter(gender == "Female") %>% summarise(m_words = var(words)) %>% pull()

# no of male
n_male <- 
memory_ability %>% filter(gender == "Male") %>% count() %>% pull()

# no of female
n_female <- 
memory_ability %>% filter(gender == "Female") %>% count() %>% pull()
```

```{r}
# Computing the t statistic
t_stat <- 
(mean_male - mean_female) / sqrt((variance_male/n_male) + (variance_female/ n_female))

t_stat

# Deriving the two-tailed p-value
pt(q = t_stat, df = 18) * 2
```


<br>

***

## References

Ho, Robert (2014).Handbook of Univariate and Multivariate Data Analysis with IBM SPSS (2nd edition). Chapman & Hall/CRC, Taylor & Francis Group.

Sheskin, David J. (2011). Handbook of Parametric and Nonparametric Statistical Procedures (5th edition). Chapman & Hall/CRC, Taylor & Francis Group.


